<div class="account-settings-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading your profile...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && isAuthenticated" class="account-card">
    <h2 class="page-title">Account Settings</h2>

    <!-- Profile Picture Section -->
    <div class="profile-section">
      <div class="avatar-container">
        <img [src]="getAvatarUrl()" alt="Profile Picture" class="avatar" />
      </div>
      <div class="user-info">
        <h3 class="user-name">{{ formData.name || 'User' }}</h3>
        <p class="user-email">{{ userProfile?.email }}</p>
      </div>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>

    <!-- Profile Form -->
    <form class="profile-form">
      <!-- Name Field -->
      <div class="form-group">
        <label class="form-label">Full Name</label>
        <input
          type="text"
          [(ngModel)]="formData.name"
          name="name"
          class="form-input"
          [readonly]="!isEditing"
          placeholder="Enter your full name"
          required
        />
      </div>

      <!-- Email Field (Read-only) -->
      <div class="form-group">
        <label class="form-label">Email</label>
        <input
          type="email"
          [value]="userProfile?.email"
          class="form-input readonly"
          readonly
        />
        <p class="field-note">Email cannot be changed</p>
      </div>

      <!-- Phone Field -->
      <div class="form-group">
        <label class="form-label">Phone Number</label>
        <input
          type="tel"
          [(ngModel)]="formData.phone"
          name="phone"
          class="form-input"
          [readonly]="!isEditing"
          placeholder="Enter your phone number"
        />
      </div>

      <!-- Address Section -->
      <div class="address-section">
        <h4 class="section-title">Address</h4>

        <div class="form-group">
          <label class="form-label">Address Line 1</label>
          <input
            type="text"
            [(ngModel)]="formData.address.addressLine1"
            name="addressLine1"
            class="form-input"
            [readonly]="!isEditing"
            placeholder="Street address, apartment"
          />
        </div>

        <div class="form-group">
          <label class="form-label">Address Line 2</label>
          <input
            type="text"
            [(ngModel)]="formData.address.addressLine2"
            name="addressLine2"
            class="form-input"
            [readonly]="!isEditing"
            placeholder="Building, floor (optional)"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">City</label>
            <input
              type="text"
              [(ngModel)]="formData.address.city"
              name="city"
              class="form-input"
              [readonly]="!isEditing"
              placeholder="City"
            />
          </div>

          <div class="form-group">
            <label class="form-label">State</label>
            <input
              type="text"
              [(ngModel)]="formData.address.state"
              name="state"
              class="form-input"
              [readonly]="!isEditing"
              placeholder="State"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Pincode</label>
            <input
              type="text"
              [(ngModel)]="formData.address.pincode"
              name="pincode"
              class="form-input"
              [readonly]="!isEditing"
              placeholder="Pincode"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Landmark</label>
            <input
              type="text"
              [(ngModel)]="formData.address.landmark"
              name="landmark"
              class="form-input"
              [readonly]="!isEditing"
              placeholder="Landmark (optional)"
            />
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="button-group">
        <!-- Edit Button (shown when not editing) -->
        <button
          *ngIf="!isEditing"
          type="button"
          (click)="toggleEdit()"
          class="btn btn-primary"
        >
          Edit Profile
        </button>

        <!-- Save and Cancel Buttons (shown when editing) -->
        <ng-container *ngIf="isEditing">
          <button
            type="button"
            (click)="saveProfile()"
            class="btn btn-success"
            [disabled]="isSaving"
          >
            {{ isSaving ? 'Saving...' : 'Save Changes' }}
          </button>

          <button
            type="button"
            (click)="cancelEdit()"
            class="btn btn-secondary"
            [disabled]="isSaving"
          >
            Cancel
          </button>
        </ng-container>
      </div>
    </form>
  </div>

  <!-- Not Authenticated -->
  <div *ngIf="!isLoading && !isAuthenticated" class="not-authenticated">
    <p>Please log in to view your account settings.</p>
    <a routerLink="/login" class="btn btn-primary">Go to Login</a>
  </div>
</div>
